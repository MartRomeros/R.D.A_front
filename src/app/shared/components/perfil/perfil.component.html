<app-header></app-header>
<div class="back-button">
  <button (click)="goBack()"><i class="bi bi-arrow-left"></i>  Volver</button>
</div>

<div class="profile-container">
  <div class="profile-section">
    <div class="section-header">
      <h2>InformaciÃ³n del Perfil</h2>
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
      <div class="form-grid">

        <div class="form-group">
          <label for="rut">RUT</label>
          <input type="text" id="rut" formControlName="rut" class="form-control" readonly />
        </div>

        <div class="form-group">
          <label for="nombre">Nombre</label>
          <input type="text" id="nombre" formControlName="nombre" class="form-control" readonly />
        </div>

        <div class="form-group">
          <label for="ubicacion">UbicaciÃ³n</label>
          <input type="text" id="ubicacion" formControlName="ubicacion" class="form-control" readonly />
        </div>

        <div class="form-group">
          <label for="telefono">TelÃ©fono</label>
          <input type="tel" id="telefono" formControlName="telefono" class="form-control" readonly />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" formControlName="email" class="form-control" readonly />
        </div>

        <!-- ContraseÃ±a fija (solo visual) -->
        <div class="form-group">
          <label for="password">ContraseÃ±a</label>
          <input type="password" id="password" class="form-control" [value]="'********'" disabled />
        </div>

        <!-- Mostrar campos de cambio de contraseÃ±a -->
        <div *ngIf="isChangingPassword">

          <!-- ContraseÃ±a actual -->
          <div class="form-group">
            <label for="currentPassword">ContraseÃ±a Actual</label>
            <div class="password-wrapper">
              <input [type]="showCurrentPassword ? 'text' : 'password'" id="currentPassword"
                     formControlName="currentPassword" class="form-control"
                     [class.error]="getFieldError('currentPassword')" />
              <button type="button" class="toggle-password" (click)="togglePasswordVisibility('current')">
                {{ showCurrentPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
            <div class="error-message" *ngIf="getFieldError('currentPassword')">
              {{ getFieldError('currentPassword') }}
            </div>
          </div>

          <!-- Nueva contraseÃ±a -->
          <div class="form-group">
            <label for="newPassword">Nueva ContraseÃ±a</label>
            <div class="password-wrapper">
              <input [type]="showNewPassword ? 'text' : 'password'" id="newPassword"
                     formControlName="newPassword" class="form-control"
                     [class.error]="getFieldError('newPassword')" />
              <button type="button" class="toggle-password" (click)="togglePasswordVisibility('new')">
                {{ showNewPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
            <div class="error-message" *ngIf="getFieldError('newPassword')">
              {{ getFieldError('newPassword') }}
            </div>
          </div>

          <!-- Confirmar contraseÃ±a -->
          <div class="form-group">
            <label for="confirmPassword">Confirmar Nueva ContraseÃ±a</label>
            <div class="password-wrapper">
              <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword"
                     formControlName="confirmPassword" class="form-control"
                     [class.error]="getFieldError('confirmPassword')" />
              <button type="button" class="toggle-password" (click)="togglePasswordVisibility('confirm')">
                {{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
            <div class="error-message" *ngIf="getFieldError('confirmPassword')">
              {{ getFieldError('confirmPassword') }}
            </div>
          </div>
        </div>
      </div>

      <div class="botones">
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="loading || profileForm.invalid">
            {{ loading ? 'Procesando...' : 'Guardar Cambios' }}
          </button>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="toggleChangePassword()">
            {{ isChangingPassword ? 'Cancelar Cambio de ContraseÃ±a' : 'Cambiar ContraseÃ±a' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
